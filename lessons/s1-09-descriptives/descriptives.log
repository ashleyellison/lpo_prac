------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/descriptives.log
  log type:  text
 opened on:  28 Oct 2020, 11:52:46

. 
. // NAME: Data cleaning
. // FILE: lecture11_descriptives.do
. // AUTH: Will Doyle
. // REVS: Benjamin Skinner
. // INIT: 6 November 2013
. // LAST: 27 October 2020
. 
. clear all                               // clear memory

. graph drop _all

. 
. /***
> #### HEADER
> 
> Incidental to the lesson today, but important to set up correctly is the header. Notice 
> that the plot and table files types are saved in global macros. With a quick switch at t
> he top of the file, you can change the file format of the plots and tables that Stata sa
> ves. Very handy.
> ***/
. 
. 
. // You'll need betterbar, tabplot
. 
. //ssc install betterbar
. //ssc install tabplot
. 
. // set link for data, plot, and table directories
. global datadir "../data/"

. global plotdir "../plots/"

. global tabsdir "../tables/"

. 
. // set plot and table types
. global gtype png

. global ttype rtf

. 
. // theme for graphics
. set scheme s1color

. 
. // open up modified plans data
. use plans2, clear

. 
. // recode
. 
. recode bypared  (1=1 "Less than HS") ///
>                                 (2=2 "HS") ///
>                                 (3/5=3 "Some College or Associate") ///
>                                 (6=4 "BA") ///
>                                 (6/8=5 "Adv Degree") , gen(bypared2)
(9655 differences between bypared and bypared2)

.                                 
. la var bypared2 "Parental Education"

. 
. // next new recoded student expectations
. recode f1psepln (1/2 = 1 "No plans") /// 
>                                 (3/4 = 2 "VoTech/CC") ///
>                                 (5 = 3 "4 yr") ///
>                                 (6 = .) ///
>                                 (. = .), gen(newpln)
(13995 differences between f1psepln and newpln)

.                                 
. label var newpln "PS Plans"

. 
. 
.                                 
. // use svyset to account for survey design
. svyset psu [pw = f1pnlwt], strat(strat_id) singleunit(scaled)

      pweight: f1pnlwt
          VCE: linearized
  Single unit: scaled
     Strata 1: strat_id
         SU 1: psu
        FPC 1: <zero>

. 
. /***
> 
> Tables
> ------
> 
> Every manuscript should include a table of descriptive statistics, listing the mean and 
> standard error or standard deviation of every variable to be used in the dataset. In add
> ition, tables should be used to convey crosstabs of two categorical variables. Most of y
> our papers will also eventually include tables for regression results. Tables should be 
> used sparingly for describing data: your best bet is almost always graphics.
> 
> For many categorical variables, however, tables may be your only option. In that case yo
> u need to think hard about two things:
> 
> 1.  How can I best show patterns in the conditional mean of my dependent variable at dif
> ferent levels of my independent variables?
> 2.  How can I best show relationships among key independent variables?
> 
> 
> Principles for displaying data
> ------------------------------
> 
> Tufte (2001) lists the following principles for describing data using graphics. He says 
> they should:
> 
> -   Show the data
> -   Induce the viewer to think about the substance rather than about the methodology, gr
> aphic design, the technology production, or something else.
> -   Avoid distorting what the data have to say.
> -   Present many numbers in a small space.
> -   Make large datasets coherent.
> -   Encourage the eye to compare different pieces of data.
> -   Reveal the data at several levels of detail, from a broad overview to fine structure
> .
> -   Serve a reasonably clear purpose: description, exploration, tabulation, or decoratio
> n.
> -   Be closely integrated with the statistical and verbal descriptions of a dataset.
> 
> Describing variation and central tendency in continuous variables
> -----------------------------------------------------------------
> 
> ### Plots
> 
> The two key tools for describing variation and central tendency in a continuous variable
>  are the kernel density plot and the histogram. A histogram should be your first choice 
> for most variables: the key decisions will be the number of bins or the frequency of the
>  plot. Histograms can also be combined across levels using the onewayplot command.
> 
> The basic histogram is shown here.
> 
> ***/
. 
. 
. // DESCRIBE THE DEPENDENT VARIABLE
. 
. // histogram of base year math score
. histogram bynels2m, name(hist_bynels2m, replace)  ///
>     xtitle("NELS-1992 Scale-Equated Math Score") ///    
>     bin(25) /// we can try different bin widths
>     percent
(bin=25, start=.1471, width=.025824)

.                 
. graph export hist_bynels2m.$gtype, name(hist_bynels2m) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/hist_bynels2m.png written in PNG 
> format)

. 
. exit 

end of do-file


. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // spikeplot of base year math score
. spikeplot bynels2m, name(spike_bynels2m,replace) ///
>     xtitle("NELS-1992 Scale-Equated Math Score") ///
>         color(blue*.5%25) // First is intensity (*), second is opacity (%)

.     
. graph export spike_bynels2m.$gtype, name(spike_bynels2m) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/spike_bynels2m.png written in PNG
>  format)

. 
end of do-file

. help kdensity

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // kernel density plot of base year math score
. kdensity bynels2m, name(kd_bynels2m, replace) ///
>     xtitle("NELS Math Scores") ///
>     n(100) ///
>     bwidth(.025) ///
>         color("98 47 117*.7%30") ///
>         recast(area) ///
>     normal /// 
>         kernel(gaussian) ///
>     normopts(lpattern(dash) color(black)) 

. 
. 
.         
. graph export kd_bynels2m.$gtype, name(kd_bynels2m) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/kd_bynels2m.png written in PNG fo
> rmat)

. 
end of do-file

. help spikeplot

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // kernel density plot of base year reading  score
. kdensity bynels2r, name(kd_bynels2r, replace) ///
>     xtitle("NELS Reading Scores") ///
>     n(100) ///
>     bwidth(.025) ///
>         color(bluishgray%75) ///
>         recast(area) ///
>         kernel(triangle) 

. 
. graph export kd_bynels2r.$gtype, name(kd_bynels2r) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/kd_bynels2r.png written in PNG fo
> rmat)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // kernel density plot of base year reading  score
. kdensity bynels2r, name(kd_bynels2r, replace) ///
>     xtitle("NELS Reading Scores") ///
>     n(100) ///
>     bwidth(.025) ///
>         color(bluishgray%75) ///
>         recast(area) ///
>         kernel(triangle) ///
>         note("")

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // kernel density plot of base year reading  score
. kdensity bynels2r, name(kd_bynels2r, replace) ///
>     xtitle("NELS Reading Scores") ///
>     n(100) ///
>     bwidth(.025) ///
>         color(bluishgray%75) ///
>         recast(area) ///
>         kernel(triangle) ///
>         note("") ///
>         title("")

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // kernel density plots of base year math score across parental education
. kdensity bynels2m if bypared == 2, name(kd_bynels2m_cond, replace) ///
>     xtitle("NELS Math Scores") ///
>     n(100) ///
>     bwidth(.025) ///
>         recast(area) ///
>         color("216 171 76* .5%50") /// 
>     addplot(kdensity bynels2m if bypared > 5, ///
>             n(100) ///
>             bwidth(.025) ///
>             color("98 47 117*.7%50") ///
>                         recast(area) ) ///
>     legend(label(1 "Parent Ed=HS") label(2 "Parent Ed=BA+")) ///
>     note("") ///
>     title("")

. 
. graph export kd_bynels2m_cond.$gtype, name(kd_bynels2m_cond) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/kd_bynels2m_cond.png written in P
> NG format)

. 
end of do-file

. help graph twoway scatter

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // barchart of base year student expectations
. histogram bystexp, name(bar_bystexp) ///
>     percent ///
>     addlabels ///
>     xlabel(-1 1 2 3 4 5 6 7, ///
>            value ///
>            angle(45) ///
>            labsize(vsmall) ///
>            ) ///
>     addlabopts(yvarformat(%4.1f)) ///
>     xtitle("")
(bin=41, start=-1, width=.19512195)

. 
end of do-file

. help graph bar

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // Similar, but using graph bar
. graph bar , over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(angle(45) labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")

. 
end of do-file

. tab byincome

           Income |      Freq.     Percent        Cum.
------------------+-----------------------------------
             none |         80        0.50        0.50
   $1,000 or less |        178        1.10        1.60
    $1,001-$5,000 |        304        1.88        3.48
   $5,001-$10,000 |        351        2.17        5.65
  $10,001-$15,000 |        697        4.31        9.96
  $15,001-$20,000 |        781        4.83       14.80
  $20,001-$25,000 |        996        6.16       20.96
  $25,001-$35,000 |      1,887       11.68       32.64
  $35,001-$50,000 |      3,017       18.67       51.31
  $50,001-$75,000 |      3,309       20.48       71.78
 $75,001-$100,000 |      2,173       13.45       85.23
$100,001-$200,000 |      1,806       11.18       96.40
 $200,001 or more |        581        3.60      100.00
------------------+-----------------------------------
            Total |     16,160      100.00

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. graph bar , over(byincome, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(angle(45) labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. graph bar , over(byincome, ///
>                                 label(angle(45) labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // Similar, but using graph bar
. graph bar , over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(angle(45) labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // using hbar instead
. graph hbar ,over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")      

. 
end of do-file

. graph pie bystexp

. graph pie , by(bystexp)
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive
sum of pie wedges is not positive

. graph pie , over(bystexp)

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // using hbar instead
. graph hbar ,over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         ytitle("")      

.         
. 
end of do-file

. graph pie , over(bystexp)

. help graph bar

. help grah bar

. help graph bar

. help graph bar

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // get mean estimates using svy
. svy: mean bynels2m bynels2r byses1 byses2 amind asian black hispanic white female
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =     361        Number of obs   =     15,512
Number of PSUs   =     751        Population size =  3,210,779
                                  Design df       =        390

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
    bynels2m |   .4485513   .0026715       .443299    .4538036
    bynels2r |   .2947283   .0017403      .2913067    .2981498
      byses1 |   .0050858   .0145406     -.0235019    .0336736
      byses2 |   .0049615   .0143462     -.0232441    .0331671
       amind |   .0096097   .0021007      .0054797    .0137397
       asian |   .0386928   .0025431      .0336929    .0436926
       black |   .1373778    .006713      .1241797    .1505759
    hispanic |   .1510179   .0084864      .1343331    .1677028
       white |   .6219287   .0099563      .6023541    .6415033
      female |   .4973999    .005431      .4867221    .5080776
--------------------------------------------------------------

. 
. // Store it
. estimates store my_mean

. 
. // store the estimates in a nice table using esttab
. esttab my_mean using means_se.$ttype, ///    // . means all in current memory
>     not ///                              // do not include t-tests 
>     replace ///                          // replace if it exists
>     nostar ///                           // no significance tests 
>     label ///                            // use variable labels 
>     main(b) ///                          // main = means 
>     aux(se) ///                          // aux = standard errors 
>     nonotes ///                          // no standard table notes 
>     nonumbers ///                        // no column/model numbers
>     addnotes("Linearized estimates of standard errors in parentheses")
(output written to means_se.rtf)

.         
. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // use tabstat to make standard deviations for table
. tabstat bynels2m bynels2r byses1 byses2, stat(sd) save 

   stats |  bynels2m  bynels2r    byses1    byses2
---------+----------------------------------------
      sd |  .1353664  .0939987  .7429628  .7502604
--------------------------------------------------

. 
. // grab matrix of sds and store in matrix
. mat mysd = r(StatTotal)

. 
. // add to earlier results using estadd
. estadd  matrix mysd: my_mean

. 
. // save new table, this time with sds instead of ses
. esttab my_mean using means_sd.$ttype, ///
>     not /// 
>     replace ///
>     nostar ///
>     label ///
>     main(b) ///
>     aux(mysd) ///                        // NOTE: aux = standard deviations
>     nonumbers ///
>     nonotes ///
>     addnotes("Standard deviations in parentheses")
(output written to means_sd.rtf)

. 
.         exit 

end of do-file


. matrix list mysd

mysd[1,4]
     bynels2m   bynels2r     byses1     byses2
sd  .13536639  .09399866  .74296283  .75026045

. estimates restore my_mean
(results my_mean are active now)

. ereturn list

scalars:
               e(rank) =  10
               e(k_eq) =  1
             e(stages) =  1
                  e(N) =  15512
             e(N_over) =  1
           e(N_strata) =  361
              e(N_psu) =  751
              e(N_pop) =  3210778.976154566
             e(census) =  0
          e(singleton) =  0
      e(N_strata_omit) =  0
               e(df_r) =  390

macros:
            e(cmdline) : "svy : mean bynels2m bynels2r byses1 byses2 amind asian black.."
                e(cmd) : "mean"
             e(prefix) : "svy"
            e(cmdname) : "mean"
            e(command) : "mean bynels2m bynels2r byses1 byses2 amind asian black hispa.."
              e(title) : "Survey: Mean estimation"
            e(vcetype) : "Linearized"
                e(vce) : "linearized"
          e(estat_cmd) : "svy_estat"
            e(varlist) : "bynels2m bynels2r byses1 byses2 amind asian black hispanic w.."
       e(marginsnotok) : "_ALL"
              e(wtype) : "pweight"
               e(wvar) : "f1pnlwt"
               e(wexp) : "= f1pnlwt"
         e(singleunit) : "scaled"
                e(su1) : "psu"
            e(strata1) : "strat_id"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 10
                  e(V) :  10 x 10
            e(_N_subp) :  1 x 10
              e(V_srs) :  10 x 10
                 e(_N) :  1 x 10
              e(error) :  1 x 10
  e(_N_strata_certain) :  1 x 1
   e(_N_strata_single) :  1 x 1
          e(_N_strata) :  1 x 1
               e(mysd) :  1 x 4

functions:
             e(sample)   

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // use tabstat to make standard deviations for table
. tabstat bynels2m bynels2r byses1 byses2 [pw=bystuwt], stat(sd) save 
pweights not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // proportions table for base year student expectations 
. estpost svy: tabulate bystexp
(running tabulate on estimation sample)

Number of strata   =       361                  Number of obs     =     15,236
Number of PSUs     =       751                  Population size   =  3,210,779
                                                Design df         =        390

----------------------
how far   |
in school |
student   |
thinks    |
will      |
get-compo |
site      | proportion
----------+-----------
 Don't Kn |      .0967
 Less tha |      .0089
       HS |      .0688
     2 yr |      .0657
  4 yr No |      .0369
 Bachelor |       .361
  Masters |      .2002
 Advanced |      .1619
          | 
    Total |          1
----------------------
  Key:  proportion  =  cell proportion

saved vectors:
             e(b) =  cell proportions
            e(se) =  standard errors of cell proportions
            e(lb) =  lower 95% confidence bounds for cell proportions
            e(ub) =  upper 95% confidence bounds for cell proportions
          e(deff) =  deff for variances of cell proportions
          e(deft) =  deft for variances of cell proportions
          e(cell) =  cell proportions
         e(count) =  weighted counts
           e(obs) =  number of observations

. 
. esttab . using proportions.$ttype, ///
>     not /// 
>     replace ///
>     nostar ///
>     label ///
>     main(b) ///
>     aux(se) ///
>     nonotes ///
>     nonumbers ///        
>     addnotes("Linearized standard errors in parentheses")
(output written to proportions.rtf)

. 
end of do-file

. help graph bar

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // using hbar instead
. graph hbar ,over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         bltitle("") ///
>         ytitle("")      
option bltitle() not allowed
r(198);

end of do-file

r(198);

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // using hbar instead
. graph hbar ,over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         b1title("") ///
>         ytitle("")      

.         
. 
end of do-file

. svy: mean bynels2m
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =     361        Number of obs   =     16,160
Number of PSUs   =     751        Population size =  3,388,462
                                  Design df       =        390

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
    bynels2m |   .4474391   .0026182      .4422915    .4525866
--------------------------------------------------------------

. estat
subcommand expected
r(198);

. estat, sd
subcommand expected
r(198);

. estat sd

-------------------------------------
             |       Mean   Std. Dev.
-------------+-----------------------
    bynels2m |   .4474391    .1345208
-------------------------------------

. svy: mean byses1
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =     361        Number of obs   =     15,512
Number of PSUs   =     751        Population size =  3,210,779
                                  Design df       =        390

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      byses1 |   .0050858   .0145406     -.0235019    .0336736
--------------------------------------------------------------

. estat sd

-------------------------------------
             |       Mean   Std. Dev.
-------------+-----------------------
      byses1 |   .0050858    .7205519
-------------------------------------

. tabstat byses1, stat(sd)

    variable |        sd
-------------+----------
      byses1 |  .7429628
------------------------

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // using hbar instead
. graph hbar ,over(bystexp, ///
>                             sort(1) ///
>                                 descending ///
>                                 label(labsize(small) ) ///
>                                 ) ///
>         blabel(bar,format(%4.1f)) ///
>         bar(1, color(blue*.5)) ///
>         b1title("") /// //X axis title
>         ytitle("")      

.         
. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // math against reading scores in scatterplot: please don't do this
. graph twoway scatter bynels2m bynels2r, name(sc_math_read)

. graph export sc_math_read.$gtype, name(sc_math_read) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/sc_math_read.png written in PNG f
> ormat)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // scatterplot with 10 percent sample of data
. preserve                                // preserve data

. sample 10                               // sample random 10%
(14,544 observations deleted)

. 
. graph twoway scatter bynels2m bynels2r, name(sc_math_read_10) ///
>   ytitle("NELS Math Scores") ///
>   xtitle("NELS Reading Scores") ///
>   msize(tiny)

. graph export sc_math_read_10.$gtype, name(sc_math_read_10) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/sc_math_read_10.png written in PN
> G format)

. 
. restore                                 // restore data

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // conditional scatterplot with 25 percent sample of data
. preserve                                // preserve data

. sample 25                               // sample random 25%
(12,120 observations deleted)

. 
. graph twoway (scatter bynels2m byses1 if urm == 0, ///
>                   mcolor(blue*.5%25) ///
>                   msize(tiny) ///
>                                   ) ///              
>               || scatter bynels2m byses1 if urm == 1, ///
>                   mcolor(orange*.5%25) ///
>                   msize(tiny) ///
>                   ytitle("NELS Math Scores") ///
>                   xtitle("SES") ///
>                   legend(order(1 "Non-Minority" 2 "Underrep Minority")) ///
>                   name(sc_complex, replace)

. 
. graph export sc_complex.$gtype, name(sc_complex) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/sc_complex.png written in PNG for
> mat)

. 
. restore  

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // conditional scatterplot with by
. graph twoway scatter bynels2m byses1, by(bystexp,note("")) ///
>     msize(*.05) ///
>         mcolor(dknavy) ///
>     ytitle("NELS Math Scores") ///
>     xtitle("SES") ///   
>     note("") ///
>     name(sc_cond, replace) 

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. graph twoway scatter bynels2m byses1, ///
>                         subtitle(, ring(0) pos(11) nobexpand fcolor(white%1) lstyle(none
> )) /// 
>                         by(bystexp, total note("")) ///
>     msize(*.05) ///
>         mcolor(dknavy) ///
>     ytitle("NELS Math Scores") ///
>     xtitle("SES") ///   
>     note("") ///
>     name(sc_cond2, replace)     

.                 
. 
. graph export sc_cond2.$gtype, name(sc_cond2) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/sc_cond2.png written in PNG forma
> t)

. 
end of do-file

. help graph twoway

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. graph twoway (scatter bynels2m byses1, msize(*.05) mcolor(dknavy)) (lfit bynels2m byses1
> ) ///
>                         subtitle(, ring(0) pos(11) nobexpand fcolor(white%1) lstyle(none
> )) /// 
>                         by(bystexp, total note("")) ///
>     ytitle("NELS Math Scores") ///
>     xtitle("SES") ///   
>     note("") ///
>     name(sc_cond2, replace)     
) required
r(100);

end of do-file

r(100);

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. graph twoway scatter bynels2m byses1, msize(*.05) mcolor(dknavy) || lfit bynels2m byses1
>  ///
>                         subtitle(, ring(0) pos(11) nobexpand fcolor(white%1) lstyle(none
> )) /// 
>                         by(bystexp, total note("")) ///
>     ytitle("NELS Math Scores") ///
>     xtitle("SES") ///   
>     note("") ///
>     name(sc_cond2, replace)     
invalid varlist
r(198);

end of do-file

r(198);

. graph twoway scatter fouryr bynels2m

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. xtile pct_math = bynels2m, nq(100)

. 
. egen fouryr_avg= mean(fouryr) , by(pct_math)

. 
. graph twoway scatter fouryr_avg pct_math, ///
>                         xtitle("Math Score Pctile") ///
>                         ytitle("Pr(Plan to go to 4yr)") ///
>                         mcolor(blue*.5%50)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // boxplot of math score over parental education
. graph box bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(tiny) ///
>                                ) ///
>                          ) ///
>                     name(box1, replace)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // boxplot of math score over parental education
. graph box bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(small) ///
>                                ) ///
>                          ) ///
>                     name(box1, replace)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. graph box bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(tiny) ///
>                                ) ///
>                          sort(1)  ///
>                                                  descending ///
>                          ) ///
>                     name(box2)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. graph hbar bynels2m bynels2r [pw=bystuwt], ///
>                 over(bystexp, sort(bynels2m) descending) ///
>                 ytitle("Test Scores") ///
>                 legend(order(1 "Math Scores" 2 "Reading Scores"))  ///
>                 blabel(bar,format(%9.2f)) ///
>                 bar(1, color(orange*.5)) bar(2, color(blue*.5))

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. //Better bar for nice CIs       
. betterbarci bynels2m bynels2r [pw=bystuwt], ///
>                         over(bypared2)  

.                                         
. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // Statplot: ssc install statplot
. statplot bynels2m bynels2r, over(bystexp,sort(1) descending) over(bysex)  name(statplot)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. // dot plots of continuous against categorical
. graph dot bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(tiny) ///
>                                ) ///
>                          ) ///
>                     ytick(0(.10).80) ///
>                     ylabel(0(.1).8) ///
>                     ytitle("Math Scores") ///
>                     marker(1, msymbol(O) mcolor(dknavy)) ///
>                     name(dot_math,replace)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. ***/    
.         
. // dot plots of continuous against categorical
. graph dot bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(small) ///
>                                ) ///
>                          ) ///
>                     ytick(0(.10).80) ///
>                     ylabel(0(.1).8) ///
>                     ytitle("Math Scores") ///
>                     marker(1, msymbol(O) mcolor(dknavy)) ///
>                     name(dot_math,replace)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

.         
. // dot plots of continuous against categorical
. graph dot bynels2m, over(bypared2, ///
>                          label(alternate ///
>                                labsize(small) ///
>                                ) ///
>                          ) ///
>                     ytick(0(.10).80) ///
>                     ylabel(0(.1).8) ///
>                     ytitle("Math Scores") ///
>                     marker(1, msymbol(O) mcolor(dknavy)) ///
>                     name(dot_math,replace)

. 
. graph save dot_math.gph, replace
(file dot_math.gph saved)

. 
. graph dot bynels2r, over(bypared2, ///
>                          label(alternate ///
>                                labsize(small) ///
>                                ) ///
>                          ) ///
>                     ytick(0(.10).80) ///
>                     ylabel(0(.1).8) ///
>                     ytitle("Reading Scores") ///
>                     marker(1, msymbol(O) mcolor(orange*.5)) ///
>                     name(dot_read,replace)

. 
. graph save dot_read.gph, replace
(file dot_read.gph saved)

. 
. // combine graphs into one plot
. graph combine dot_math.gph dot_read.gph, ///
>     name(dot_both, replace) ///
>         cols(1)

. 
. 
. // export combined graphics
. graph export dot_both.$gtype, name(dot_both) replace
(file /Users/doylewr/lpo_prac/lessons/s1-09-descriptives/dot_both.png written in PNG forma
> t)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. //  cross table of categorical
. estpost svy: tabulate byrace2 newpln, row percent se
(running tabulate on estimation sample)

Number of strata   =       361                  Number of obs     =     13,055
Number of PSUs     =       750                  Population size   =  2,908,622
                                                Design df         =        389

--------------------------------------------------
RECODE of |
byrace    |
(student^ |
s         |
race/ethn |
icity-com |                PS Plans               
posite)   | No plans  VoTech/C      4 yr     Total
----------+---------------------------------------
  Am.Ind. |    16.17     26.93     56.89       100
          |  (3.647)   (4.454)   (5.413)          
          | 
 Asian/PI |    4.746     23.67     71.59       100
          |  (.8931)   (1.933)   (2.107)          
          | 
    Black |     7.31      29.9     62.79       100
          |  (.7736)   (1.368)   (1.487)          
          | 
 Hispanic |    9.732     43.95     46.32       100
          |  (.8412)   (1.494)   (1.699)          
          | 
 Multirac |    12.27     30.13      57.6       100
          |   (1.72)   (2.436)   (2.591)          
          | 
    White |    8.147     28.26     63.59       100
          |  (.3851)   (.8152)   (.9036)          
          | 
    Total |    8.369      30.6     61.04       100
          |  (.3292)   (.6266)   (.7225)          
--------------------------------------------------
  Key:  row percentage
        (linearized standard error of row percentage)

  Pearson:
    Uncorrected   chi2(10)        =  253.9129
    Design-based  F(9.11, 3544.12)=   17.6793     P = 0.0000

Note: Variance scaled to handle strata with a single sampling unit.

saved vectors:
             e(b) =  row percentages
            e(se) =  standard errors of row percentages
            e(lb) =  lower 95% confidence bounds for row percentages
            e(ub) =  upper 95% confidence bounds for row percentages
          e(deff) =  deff for variances of row percentages
          e(deft) =  deft for variances of row percentages
          e(cell) =  cell percentages
           e(row) =  row percentages
           e(col) =  column percentages
         e(count) =  weighted counts
           e(obs) =  number of observations

row labels saved in macro e(labels)

. 
. eststo racetab

. 
. esttab racetab using race_tab.$ttype, ///
>     replace ///
>     nostar ///
>     unstack ///
>     nonotes ///
>         nomtitles ///
>         nonumbers ///
>     varlabels(`e(labels)') ///
>     eqlabels(`e(eqlabels)')
(output written to race_tab.rtf)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // tabplot of parental education against student plans
. tabplot bypared2 newpln, name(tabplot1, replace) ///
>     percent(bypared2) ///
>     showval ///
>     subtitle("") 

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. // jitter categorical against categorical
. graph twoway scatter f1psepln bypared

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // jitter categorical against categorical
. graph twoway scatter f1psepln bypared, name(jitterplot) ///
>     jitter(5) ///
>     msize(vtiny) ///
>         mcolor(dknavy)

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. 
. // heatmap of base year student plans and parental education
. tddens bypared f1psepln, title("") ///
>     xtitle("Parent's Level of Education") ///
>     ytitle("PS PLans")

.     
. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04781.000000"

. capture log close
